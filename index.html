<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Operador</title>

<style>
body{font-family:Arial;background:#f2f2f2;margin:0}
.container{
  max-width:900px;
  margin:30px auto;
  background:#fff;
  padding:20px;
  border-radius:8px;
}
.hidden{display:none}
textarea,input,button{width:100%;padding:10px;margin-top:8px}
button{cursor:pointer;border:0;border-radius:5px}
.aplicar{background:#007bff;color:#fff}
.whats{background:#25d366;color:#fff;padding:6px 10px}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ddd;padding:8px;font-size:13px}
th{background:#eee}
</style>
</head>

<body>

<div class="container" id="login">
  <h3>Login</h3>
  <input id="u" placeholder="Usuário">
  <input id="p" type="password" placeholder="Senha">
  <button onclick="entrar()">Entrar</button>
</div>

<div class="container hidden" id="painel">
  <h3>Lista de Contatos</h3>

  <textarea id="numeros" rows="5" placeholder="Cole os números"></textarea>

  <textarea id="msg" rows="3">Olá! Aqui é da LR Empréstimo.</textarea>

  <input id="operador" placeholder="Nome do operador">

  <button class="aplicar" onclick="aplicar()">Aplicar</button>

  <table>
    <thead>
      <tr>
        <th>Número</th>
        <th>Ação</th>
      </tr>
    </thead>
    <tbody id="lista"></tbody>
  </table>
</div>

<script>
const API = "https://api-emprestimo-operador.onrender.com";

function entrar(){
  if(u.value==="adminglps" && p.value==="admin1533"){
    login.classList.add("hidden");
    painel.classList.remove("hidden");
    carregarHistorico();
  }else{
    alert("Login inválido");
  }
}

async function carregarHistorico(){
  const res = await fetch(API+"/contatos");
  const dados = await res.json();
  lista.innerHTML="";
  dados.forEach(renderLinha);
}

function aplicar(){
  const nums = numeros.value
    .split(/\s+/)
    .map(n=>n.replace(/\D/g,""))
    .filter(n=>n.length>=10);

  nums.forEach(async numero=>{
    const contato = {
      operador: operador.value || "Operador",
      numero,
      mensagem: msg.value
    };

    await fetch(API+"/contatos",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(contato)
    });

    renderLinha(contato);
  });

  numeros.value="";
}

function renderLinha(contato){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td>${contato.numero}</td>
    <td>
      <button class="whats" onclick="abrirWhats('${contato.numero}','${contato.mensagem}')">
        WhatsApp
      </button>
    </td>
  `;
  lista.appendChild(tr);
}

function abrirWhats(numero,mensagem){
  const texto=encodeURIComponent(mensagem);
  window.open(`https://api.whatsapp.com/send?phone=${numero}&text=${texto}`);
}
</script>

</body>
</html>
