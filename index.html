<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Operador | LR Empr√©stimo</title>

<style>
body{
  margin:0;
  font-family:system-ui,Arial;
  background:#f4f6f8;
}
.container{
  max-width:1000px;
  margin:30px auto;
  background:#fff;
  padding:25px;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
}
.hidden{display:none}
h2{margin-top:0}
textarea,input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:14px;
}
button{
  border:0;
  border-radius:8px;
  cursor:pointer;
}
.btn-login{background:#333;color:#fff}
.btn-gerar{background:#1c9bd6;color:#fff}
.btn-whats{background:#25d366;color:#fff;font-size:13px}
.card{
  background:#f9f9f9;
  padding:15px;
  border-radius:8px;
  margin-top:15px;
}
.lista{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:10px;
}
.item{
  background:#fff;
  border:1px solid #ddd;
  padding:10px;
  border-radius:8px;
  font-size:13px;
}
.counter{
  font-weight:700;
  margin-bottom:10px;
}
footer{
  text-align:center;
  font-size:12px;
  color:#666;
  margin-top:20px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="container" id="loginBox">
  <h2>üîê Login Operador</h2>
  <input id="user" placeholder="Usu√°rio">
  <input id="pass" type="password" placeholder="Senha">
  <button class="btn-login" onclick="login()">Entrar</button>
</div>

<!-- PAINEL -->
<div class="container hidden" id="painel">

  <h2>üì≤ Envio em Massa ‚Äì LR Empr√©stimo</h2>

  <div class="counter">
    Total de contatos enviados: <span id="total">0</span>
  </div>

  <div class="card">
    <input id="operador" placeholder="Nome do operador">

    <textarea id="mensagem" rows="3">
Ol√°! Aqui √© da LR Empr√©stimo.
Voc√™ tem uma oportunidade de cr√©dito liberada.
Posso te explicar rapidinho?
    </textarea>

    <textarea id="listaNumeros" rows="6" placeholder="Cole aqui a lista de n√∫meros (um por linha, com DDD)"></textarea>

    <button class="btn-gerar" onclick="gerar()">Gerar contatos</button>
  </div>

  <div class="card">
    <h3>Contatos gerados</h3>
    <div class="lista" id="contatos"></div>
  </div>

</div>

<footer>
LR Empr√©stimo ¬© 2026 ‚Äì Sistema Operacional
</footer>

<script>
const API = "https://api-emprestimo-operador.onrender.com";

function login(){
  if(user.value==="adminglps" && pass.value==="admin1533"){
    loginBox.classList.add("hidden");
    painel.classList.remove("hidden");
    carregarContador();
  }else{
    alert("Usu√°rio ou senha incorretos");
  }
}

async function carregarContador(){
  const r = await fetch(API+"/contador");
  const d = await r.json();
  total.innerText = d.total;
}

function gerar(){
  contatos.innerHTML = "";
  const nums = listaNumeros.value
    .split(/\s+/)
    .map(n=>n.replace(/\D/g,""))
    .filter(n=>n.length>=10);

  nums.forEach(n=>{
    const div = document.createElement("div");
    div.className="item";
    div.innerHTML = `
      <strong>${n}</strong><br><br>
      <button class="btn-whats" onclick="enviar('${n}')">WhatsApp</button>
    `;
    contatos.appendChild(div);
  });
}

async function enviar(numero){
  const msg = mensagem.value;

  await fetch(API+"/enviar",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      operador: operador.value || "Operador",
      numero,
      mensagem: msg
    })
  });

  const texto = encodeURIComponent(msg);
  window.open(`https://wa.me/${numero}?text=${texto}`,"_blank");

  carregarContador();
}
</script>

</body>
</html>
